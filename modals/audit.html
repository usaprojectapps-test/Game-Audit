<section class="module-container">

  <div class="module-wrapper audit-module">

    <!-- =========================
         LEFT SIDE (65%)
    ========================== -->
    <div class="module-left">

      <!-- SUMMARY BLOCK -->
      <div class="audit-summary-row">

        <div class="row-2col">
          <div class="form-item">
            <label>Location</label>
            <select id="auditLocationSelect"></select>
          </div>

          <div class="form-item">
            <label>Date</label>
            <input type="date" id="auditFilterDate">
          </div>

          <div class="summary-vertical">
            <span>Total Machines: <strong id="summaryTotalMachines">0</strong></span>
            <span>Total Jackpot: <strong id="summaryTotalJackpot">$ 0.00</strong></span>
          </div>
        </div>

        <div class="row-3col summary-horizontal">
          <span>Total IN: <strong id="summaryTotalIn">$ 0.00</strong></span>
          <span>Total OUT: <strong id="summaryTotalOut">$ 0.00</strong></span>
          <span>NET: <strong id="summaryNet">$ 0.00</strong></span>
        </div>

      </div>

      <!-- TABLE (SCROLLS) -->
      <div class="full-width">
        <div class="table-wrapper">
          <table id="auditTable" class="striped">
            <thead>
              <tr>
                <th>Machine</th>
                <th>Prev IN</th>
                <th>Prev OUT</th>
                <th>Cur IN</th>
                <th>Cur OUT</th>
                <th>Jackpot</th>
                <th>Total IN</th>
                <th>Total OUT</th>
                <th>NET</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </div>

    <!-- =========================
         RIGHT SIDE (35%)
    ========================== -->
    <div class="module-right">

      <div class="card-header">AUDIT Entry Form</div>

      <!-- FORM GRID (2 COLUMNS ALWAYS) -->
      <div class="form-grid">

       <div class="form-group form-span-2">
          <div class="audit-top-row">
            <div class="audit-date">
              <label>Date</label>
              <input type="date" id="auditEntryDate">
            </div>

            <div class="audit-machine">
              <label>Machine No</label>
              <div class="qr-input-group">
                <input type="text" id="auditMachineNo" placeholder="Scan or enter manually">
                <button id="qrScanBtn" title="Scan QR">ðŸ“·</button>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Prev IN</label>
          <input type="number" id="auditPrevIn" readonly>
        </div>

        <div class="form-group">
          <label>Prev OUT</label>
          <input type="number" id="auditPrevOut" readonly>
        </div>

        <div class="form-group">
          <label>Cur IN</label>
          <input type="number" id="auditCurIn">
        </div>

        <div class="form-group">
          <label>Cur OUT</label>
          <input type="number" id="auditCurOut">
        </div>

        <div class="form-group">
          <label>Jackpot</label>
          <input type="number" id="auditJackpot" placeholder="Optional">
        </div>

        <div class="form-group">
          <label>Machine Health</label>
          <select id="auditMachineHealth">
            <option value="">Select</option>
            <option value="Active">Active</option>
            <option value="Issue">Issue</option>
            <option value="Inactive">Inactive</option>
          </select>
        </div>

        <!-- FULL-WIDTH BUTTONS -->
        <div class="form-group form-span-2 form-actions">
          <button id="auditSaveBtn" class="btn btn-primary">Save</button>
          <button id="auditResetBtn" class="btn btn-secondary">Reset</button>
        </div>

        <div class="audit-totals-row">
          <span>Total IN: <strong id="auditTotalIn">$ 0.00</strong></span>
          <span>Total OUT: <strong id="auditTotalOut">$ 0.00</strong></span>
          <span>NET: <strong id="auditNet">$ 0.00</strong></span>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- QR MODAL -->
<div id="qrModal" class="qr-overlay" style="display:none;">
  <div class="qr-modal" role="dialog" aria-modal="true">
    <video id="qrVideo" class="qr-video"></video>
    <button id="qrCloseBtn" class="qr-close-btn">Close</button>
  </div>
</div>

<script type="module">
  import jsQR from "https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js";
  window.jsQR = jsQR;
</script>

<script src="/js_new/qr-scanner.js" defer></script>
<script src="/js_new/audit.js" defer></script>

<script>
  window.dispatchEvent(new Event("auditModuleLoaded"));
</script>
