<section class="audit-module-container">
  <div class="module-wrapper audit-module">
    <!-- LEFT: summary + table -->
    <div class="module-left">
      <!-- Row 1: 3 columns -->
      <div class="audit-summary-row">
         <div class="row-3col"> 
            <div class="form-item">
              <label>Location</label>
              <select id="auditLocationSelect"></select>
            </div>

            <div class="form-item">
              <label>Date</label>
              <input type="date" id="auditFilterDate">
            </div>
            <span>Total Machines: <strong id="summaryTotalMachines">2</strong></span>
            <span>Total Jackpot: <strong id="summaryTotalJackpot">$ 0.00</strong></span>

            <span>Total IN: <strong id="summaryTotalIn">$ 200.00</strong></span>
        
            <span>Total OUT: <strong id="summaryTotalOut">$ 70.00</strong></span>
        
            <span>NET: <strong id="summaryNet">$ 130.00</strong></span>
          </div>
        </div>
      
      <!-- Table -->
      <div class="full-width">
        <div class="table-wrapper">
          <table id="auditTable" class="striped">
            <thead>
              <tr>
                <th>Machine</th>
                <th>Prev IN</th>
                <th>Prev OUT</th>
                <th>Cur IN</th>
                <th>Cur OUT</th>
                <th>Total IN</th>
                <th>Total OUT</th>
                <th>NET</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>  
    </div>  
    
    <!-- RIGHT: form -->
    <div class="module-right">
      <div class="card-header">AUDIT Entry Form</div>

      <!-- Row 1: 2 columns -->
      <div class="row-2col">
        <div class="form-item">
          <label>Date</label>
          <input type="date" id="auditEntryDate">
        </div>

        <div class="form-item">
          <label>Machine No</label>
          <div style="display:flex; gap:8px;">
            <input type="text" id="auditMachineNo" placeholder="Scan or enter manually" style="flex:1;">
            <button id="qrScanBtn" title="Scan QR" style="padding:6px 10px;">ðŸ“·</button>
          </div>
        </div>
      </div>
      <!-- Row 2: 2 columns -->
      <div class="row-2col">
        <div class="form-item">
          <label>Prev IN</label>
          <input type="number" id="auditPrevIn" readonly>
        </div>

        <div class="form-item">
          <label>Prev OUT</label>
          <input type="number" id="auditPrevOut" readonly>
        </div>
      </div>
      <!-- Row 3: 2 columns -->
      <div class="row-2col">
        <div class="form-item">
          <label>Cur IN</label>
          <input type="number" id="auditCurIn">
        </div>

        <div class="form-item">
          <label>Cur OUT</label>
          <input type="number" id="auditCurOut">
        </div>
      </div>
<!-- Row 4: 2 columns -->
      <div class="row-2col">
        <div class="form-item">
          <label>Jackpot</label>
          <input type="number" id="auditJackpot" placeholder="Optional">
        </div>

        <div class="form-item">
          <label>Machine Health</label>
          <select id="auditMachineHealth">
            <option value="">Select</option>
            <option value="Active">Active</option>
            <option value="Issue">Issue</option>
            <option value="Inactive">Inactive</option>
          </select>
        </div>
      </div>
      <!-- Buttons -->
      <div class="full-width form-actions">
        <button id="auditSaveBtn" class="btn btn-primary">Save</button>
        <button id="auditResetBtn" class="btn">Reset</button>
      </div>

      <!-- Row 5: 3 columns -->
      <div class="row-3col">
        <div class="form-item">
          <label>Total IN</label>
          <input type="number" id="auditTotalIn" readonly>
        </div>

        <div class="form-item">
          <label>Total OUT</label>
          <input type="number" id="auditTotalOut" readonly>
        </div>

        <div class="form-item">
          <label>NET</label>
          <input type="number" id="auditNet" readonly>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- QR Modal -->
<div id="qrModal" class="qr-overlay" style="display:none;">
  <div class="qr-modal" role="dialog" aria-modal="true">
    <video id="qrVideo" class="qr-video"></video>
    <button id="qrCloseBtn" class="qr-close-btn">Close</button>
  </div>
</div>

<!-- QR Scanner -->
<script type="module">
  import jsQR from "https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js";
  window.jsQR = jsQR;
</script>

<script src="/js_new/qr-scanner.js" defer></script>
<script src="/js_new/audit.js" defer></script>

<script>
  // IMPORTANT: triggers audit.js initialization
  window.dispatchEvent(new Event("auditModuleLoaded"));
</script>
